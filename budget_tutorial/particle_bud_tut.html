

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Tracking Labrador Sea Water‚Äôs with Lagrangian budget &#8212; Seaduck Tutorial</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'budget_tutorial/particle_bud_tut';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="A guide for new contributors" href="../guide_for_developer.html" />
    <link rel="prev" title="Calculating the mean Eulerian salinity budget in ECCOv4r4" href="mean_eul_budg.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Seaduck Tutorial - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Seaduck Tutorial - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorial</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../how_to_install.html">How to install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../how_to_cite.html">How to cite</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../get_started.html">Get started</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../one_min_guide.html">One minute guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../network_of_object.html">Learn about <code class="docutils literal notranslate"><span class="pre">seaduck</span></code> core objects and functions</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../public_api_reference.html">Public API Reference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/apiref_OceData.html">seaduck.OceData</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/apiref_topology.html">seaduck.topology</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/apiref_eulerian.html">seaduck.eulerian</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/apiref_lagrangian.html">seaduck.lagrangian</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/apiref_OceInterp.html">seaduck.OceInterp</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/apiref_kernelNweight.html">seaduck.kernel_weight</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/apiref_eulerian_budget.html">seaduck.eulerian_budget</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/apiref_lagrangian_budget.html">seaduck.lagrangian_budget</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../internal_api_reference.html">Internal API reference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/apiref_smartread.html">seaduck.smart_read</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/apiref_getmasks.html">seaduck.get_masks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/apiref_utils.html">seaduck.utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/apiref_RelCoord.html">seaduck.ocedata.RelCoord and subclasses</a></li>

</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../ideal_test.html">Examples using idealized fields</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../idealize_test/hor_stream.html">Horizontal stream function conservation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../idealize_test/ver_stream.html">Vertical stream function conservation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../idealize_test/tilted_stream.html">Tilted solid-body rotation</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ocean_example.html">Examples using ocean datasets</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../notebook/global_ECCO.html">Use <code class="docutils literal notranslate"><span class="pre">seaduck.OceInterp</span></code> with ECCO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebook/AVISO.html">Use <code class="docutils literal notranslate"><span class="pre">seaduck.Particle</span></code> with AVISO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebook/ASTE_sd.Particle_example.html">Using <code>seaduck.Particle</code> with ASTE</a></li>
<li class="toctree-l2"><a class="reference internal" href="../notebook/topology_tutorial.html">Topology tutorial</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../sciserver_example.html">Examples using SciServer ocean datasets</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../sciserver_notebooks/IGPwinter.html"><code class="docutils literal notranslate"><span class="pre">Particle</span></code> in an East Greenland regional simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sciserver_notebooks/KangerFjord.html">Demonstrate <code class="docutils literal notranslate"><span class="pre">eulerian.Position</span></code> object with Fjord</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sciserver_notebooks/LLC4320.html">Plot surface streamlines on LLC4320</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sciserver_notebooks/ECCO_plot_stations.html"><code class="docutils literal notranslate"><span class="pre">OceInterp</span></code> interpolation in the ECCO global state estimate.</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../bud_tut.html">Tutorials for Lagrangian tracer budget</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="mean_eul_budg.html">Calculating the mean Eulerian salinity budget in ECCOv4r4</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Tracking Labrador Sea Water‚Äôs with Lagrangian budget</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../guide_for_developer.html">A guide for new contributors</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../contribute/use_git.html">Using Git and Github</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute/prep_env.html">Prepare the environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute/contr_cod.html">Contributing to codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute/contr_doc.html">Contributing to documentationü¶Ü</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute/report_iss.html">Report Issues on GitHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contribute/tidyNpr.html">Tidy it up and make Pull Request</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/budget_tutorial/particle_bud_tut.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Tracking Labrador Sea Water‚Äôs with Lagrangian budget</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">0. Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#find-labrador-sea-water">1. Find Labrador Sea Water</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simulate-particle-trajectories">2. Simulate particle trajectories</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#budget-on-trajectories">3. Budget on trajectories</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-results">4. Visualizing the results</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#budget-closure-revisited">5. Budget closure revisited.</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="tracking-labrador-sea-water-s-with-lagrangian-budget">
<h1>Tracking Labrador Sea Water‚Äôs with Lagrangian budget<a class="headerlink" href="#tracking-labrador-sea-water-s-with-lagrangian-budget" title="Permalink to this heading">#</a></h1>
<p>Wenrui Jiang, Feb 2026</p>
<p>The method illustrated in this notebook can be found in our paper titled <a class="reference external" href="https://agupubs.onlinelibrary.wiley.com/doi/10.1029/2024MS004848">‚ÄúTracer Budgets on Lagrangian Trajectories‚Äù</a>.</p>
<p>This is No.2 of a serie of 2 tutorial notebooks. The first can be found <a class="reference internal" href="mean_eul_budg.html"><span class="doc std std-doc">here</span></a>.</p>
<section id="setup">
<h2>0. Setup<a class="headerlink" href="#setup" title="Permalink to this heading">#</a></h2>
<p>Let‚Äôs load some packages and read the file we just generated from the <a class="reference internal" href="mean_eul_budg.html"><span class="doc std std-doc">Eulerian budget tutorial</span></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">cartopy.crs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ccrs</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.gridspec</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gridspec</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">seaduck</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sd</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sd</span><span class="o">.</span><span class="n">__version__</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;0.1.dev1+g64706347f&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_zarr</span><span class="p">(</span><span class="s1">&#39;lag_budg.zarr&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<p>Using volume transport is a more accurate way to calculate particle trajectories compared to velocity. It is essential for budget closure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;utrans&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">u_bar</span><span class="o">*</span><span class="n">ds</span><span class="o">.</span><span class="n">dyG</span><span class="o">*</span><span class="n">ds</span><span class="o">.</span><span class="n">drF</span>
<span class="n">ds</span><span class="p">[</span><span class="s1">&#39;vtrans&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">v_bar</span><span class="o">*</span><span class="n">ds</span><span class="o">.</span><span class="n">dxG</span><span class="o">*</span><span class="n">ds</span><span class="o">.</span><span class="n">drF</span>
<span class="n">ds</span><span class="p">[</span><span class="s1">&#39;wtrans&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">w_bar</span><span class="o">*</span><span class="n">ds</span><span class="o">.</span><span class="n">rA</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AttributeError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;utrans&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">u_bar</span><span class="o">*</span><span class="n">ds</span><span class="o">.</span><span class="n">dyG</span><span class="o">*</span><span class="n">ds</span><span class="o">.</span><span class="n">drF</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;vtrans&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">v_bar</span><span class="o">*</span><span class="n">ds</span><span class="o">.</span><span class="n">dxG</span><span class="o">*</span><span class="n">ds</span><span class="o">.</span><span class="n">drF</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;wtrans&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">w_bar</span><span class="o">*</span><span class="n">ds</span><span class="o">.</span><span class="n">rA</span>

<span class="nn">File ~/micromamba/envs/DEVELOP/lib/python3.11/site-packages/xarray/core/common.py:306,</span> in <span class="ni">AttrAccessMixin.__getattr__</span><span class="nt">(self, name)</span>
<span class="g g-Whitespace">    </span><span class="mi">304</span>         <span class="k">with</span> <span class="n">suppress</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">305</span>             <span class="k">return</span> <span class="n">source</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
<span class="ne">--&gt; </span><span class="mi">306</span> <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">307</span>     <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">!r}</span><span class="s2"> object has no attribute </span><span class="si">{</span><span class="n">name</span><span class="si">!r}</span><span class="s2">&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">308</span> <span class="p">)</span>

<span class="ne">AttributeError</span>: &#39;Dataset&#39; object has no attribute &#39;u_bar&#39;
</pre></div>
</div>
</div>
</div>
<p>Here are the right-hand-side (RHS) terms of:
$<span class="math notranslate nohighlight">\(\Large\frac{\bar d \bar S}{dt} = \frac{\partial{\overline{S}}}{\partial{t}}  +\overline{u}\cdot\nabla{\overline{S}}=  - \nabla_h\cdot{\overline{DIF}_{x,y}}- \partial_z{\overline{DIF}_{z}} + \overline{F}- \overline{u'\cdot\nabla s'}\)</span>$</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rhs_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;dif_h&#39;</span><span class="p">,</span><span class="s1">&#39;dif_v&#39;</span><span class="p">,</span><span class="s1">&#39;forc_s&#39;</span><span class="p">,</span><span class="s1">&#39;neg_upgradsp_bar&#39;</span><span class="p">]</span>
<span class="n">longname</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;dif_h&#39;</span><span class="p">:</span> <span class="s1">&#39;Horizontal Diffusion&#39;</span><span class="p">,</span>
    <span class="s1">&#39;dif_v&#39;</span><span class="p">:</span> <span class="s1">&#39;Vertical Diffusion&#39;</span><span class="p">,</span>
    <span class="s1">&#39;forc_s&#39;</span><span class="p">:</span> <span class="s1">&#39;Surface Forcing&#39;</span><span class="p">,</span>
    <span class="s1">&#39;neg_upgradsp_bar&#39;</span><span class="p">:</span> <span class="s1">&#39;Eddy Transport&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<p>Now, create the OceData object</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tub</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">OceData</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="find-labrador-sea-water">
<h2>1. Find Labrador Sea Water<a class="headerlink" href="#find-labrador-sea-water" title="Permalink to this heading">#</a></h2>
<p>First we find the Labrador Sea:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">labr_sea</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="o">&lt;-</span><span class="mi">50</span><span class="p">)</span><span class="o">&amp;</span>
    <span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="o">&gt;-</span><span class="mi">65</span><span class="p">)</span><span class="o">&amp;</span>
    <span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="o">&lt;</span><span class="mi">70</span><span class="p">)</span><span class="o">&amp;</span>
    <span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="o">&gt;</span><span class="mi">55</span><span class="p">)</span><span class="o">&amp;</span>
    <span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">hFacC</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;face&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>There is quite a bit of water in this area that falls in a very narrow salinity band. Who would have thought?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mode_water</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">labr_sea</span><span class="p">)</span><span class="o">&amp;</span>
    <span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">S_bar</span><span class="o">&lt;</span><span class="mf">34.89</span><span class="p">)</span><span class="o">&amp;</span>
    <span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">S_bar</span><span class="o">&gt;</span><span class="mf">34.84</span><span class="p">)</span>
<span class="p">)</span>
<span class="c1"># labr_sea_mask = np.logical_and.reduce(labr_sea_criterion)</span>
</pre></div>
</div>
</div>
</div>
<p>Here is the Labrador Sea Water on a map‚Ä¶</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">iy</span> <span class="o">=</span><span class="mi">72</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">LambertConformal</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=-</span><span class="mf">50.0</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mf">55.0</span><span class="p">))</span>
<span class="c1"># for fc in [2,6,10]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span><span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span>
               <span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">drF</span><span class="o">*</span><span class="n">mode_water</span><span class="p">[:,</span><span class="mi">10</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span> <span class="o">=</span> <span class="s1">&#39;Z&#39;</span><span class="p">),</span>
               <span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;binary&quot;</span><span class="p">,</span>
               <span class="n">transform</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="n">iy</span><span class="p">],</span><span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="n">iy</span><span class="p">],</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">transform</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">80</span><span class="p">],</span><span class="n">crs</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Labrador Sea Water Thickness (m)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>‚Ä¶ and at a vertical section:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">iy</span> <span class="o">=</span> <span class="mi">72</span>
<span class="n">section</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">S_bar</span><span class="p">[:,</span><span class="mi">10</span><span class="p">,</span><span class="n">iy</span><span class="p">])</span>
<span class="n">section</span><span class="p">[</span><span class="n">section</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="n">iy</span><span class="p">],</span><span class="n">ds</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span><span class="n">section</span><span class="p">,</span><span class="n">vmax</span> <span class="o">=</span> <span class="mi">35</span><span class="p">,</span><span class="n">vmin</span> <span class="o">=</span> <span class="mf">34.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="n">iy</span><span class="p">],</span><span class="n">ds</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span><span class="n">mode_water</span><span class="p">[:,</span><span class="mi">10</span><span class="p">,</span><span class="n">iy</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">52</span><span class="p">,</span><span class="mi">70</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">3700</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Vertical Section along the Red Line&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Vertical Section at the red line. The shading shows salinity, and the contours shows the location of Labrador Sea Water</p>
</section>
<section id="simulate-particle-trajectories">
<h2>2. Simulate particle trajectories<a class="headerlink" href="#simulate-particle-trajectories" title="Permalink to this heading">#</a></h2>
<p>Now we create a <code class="docutils literal notranslate"><span class="pre">Particle</span></code> object. There are a couple of keyword arguments that are worth noticing:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bool_array</span></code>+<code class="docutils literal notranslate"><span class="pre">num</span></code> is an alternative way to initialize particle without specifying x,y,z. The code will randomly place about <code class="docutils literal notranslate"><span class="pre">num</span></code> particles uniformly where <code class="docutils literal notranslate"><span class="pre">bool_array</span></code> is True. You can also pass a float array into <code class="docutils literal notranslate"><span class="pre">bool_array</span></code> to give it some weight. <code class="docutils literal notranslate"><span class="pre">random_seed</span></code> is optional.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">save_raw=True</span></code> to record every grid cell crossing, this is <strong>essential</strong> for closing budget</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">transport</span> <span class="pre">=</span> <span class="pre">True</span></code> to have the u,v,w variables interpreted as volume flux.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">Particle</span><span class="p">(</span>
    <span class="n">bool_array</span><span class="o">=</span><span class="n">mode_water</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">t</span> <span class="o">=</span> <span class="mf">5e7</span><span class="p">,</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">tub</span><span class="p">,</span> <span class="n">free_surface</span> <span class="o">=</span> <span class="s1">&#39;noflux&#39;</span><span class="p">,</span>
    <span class="n">save_raw</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span><span class="n">uname</span> <span class="o">=</span> <span class="s1">&#39;utrans&#39;</span><span class="p">,</span><span class="n">vname</span> <span class="o">=</span> <span class="s1">&#39;vtrans&#39;</span><span class="p">,</span><span class="n">wname</span> <span class="o">=</span> <span class="s1">&#39;wtrans&#39;</span><span class="p">,</span>
    <span class="n">transport</span>  <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>To minimize the runtime and the storage demand, we only put about 3000 particles (not exactly), and each particle represent a fairly large volume.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vol_each</span> <span class="o">=</span> <span class="nb">float</span><span class="p">((</span><span class="n">ds</span><span class="o">.</span><span class="n">drF</span><span class="o">*</span><span class="n">ds</span><span class="o">.</span><span class="n">rA</span><span class="o">*</span><span class="n">ds</span><span class="o">.</span><span class="n">hFacC</span><span class="o">*</span><span class="n">mode_water</span><span class="p">[:,</span><span class="mi">10</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">N</span><span class="o">/</span><span class="mf">1e9</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Each particle represent a volume of:&#39;</span><span class="p">,</span><span class="n">vol_each</span><span class="p">,</span> <span class="s1">&#39;km¬≥&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;There is a total of </span><span class="si">{</span><span class="n">p</span><span class="o">.</span><span class="n">N</span><span class="si">}</span><span class="s1"> particles.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>You probably noticed that we set <code class="docutils literal notranslate"><span class="pre">t</span> <span class="pre">=</span> <span class="pre">5e7</span></code> seconds, or about 1.58 years when we initiated <code class="docutils literal notranslate"><span class="pre">Particle</span></code>. Since the velocity field is time-independent, we only care about the duration rather than the absolute value of time. Let‚Äôs simulated the Particle back for 1.58 years to reach <code class="docutils literal notranslate"><span class="pre">t=0</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stops</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we simulate the particles. <code class="docutils literal notranslate"><span class="pre">dump_filename</span></code> will let the code know to save it in a file.</p>
<p>I highly recommend that you <code class="docutils literal notranslate"><span class="pre">preserve_checks</span></code> for reasons that will be obvious shortly after, especially when you run it for the first time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p</span><span class="o">.</span><span class="n">to_list_of_time</span><span class="p">(</span><span class="n">normal_stops</span> <span class="o">=</span> <span class="n">stops</span><span class="p">,</span>
                  <span class="n">dump_filename</span> <span class="o">=</span> <span class="s1">&#39;ls_mode_water_&#39;</span><span class="p">,</span>
                  <span class="n">store_kwarg</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;preserve_checks&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">})</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="budget-on-trajectories">
<h2>3. Budget on trajectories<a class="headerlink" href="#budget-on-trajectories" title="Permalink to this heading">#</a></h2>
<p>first we load the file we stored:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">traj</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_zarr</span><span class="p">(</span><span class="s1">&#39;ls_mode_water_1970-01-01T00:00:00&#39;</span><span class="p">)</span>
<span class="n">traj</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">nprof</span></code> is an index of all the instances of particle crossing grid cell wall+the beginning and the end of the time step. <code class="docutils literal notranslate"><span class="pre">shapes</span></code> tell you how many such instances happen for each particles.</p>
<p>Now, a very important step. check if what we have done so far is correct. We calculate <span class="math notranslate nohighlight">\(-\nabla \cdot (US)\)</span> from <code class="docutils literal notranslate"><span class="pre">traj</span></code> using the extra variables we saved when we <code class="docutils literal notranslate"><span class="pre">preserve_checks</span></code> and compare that to the Eulerian budget we calculated earlier.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ans</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">lagrangian_budget</span><span class="o">.</span><span class="n">check_particle_data_compat</span><span class="p">(</span><span class="n">traj</span><span class="p">,</span><span class="n">ds</span><span class="p">,</span>
                                                        <span class="n">p</span><span class="o">.</span><span class="n">tp</span><span class="p">,</span>
                                                        <span class="n">wall_names</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;sx_bar&#39;</span><span class="p">,</span><span class="s1">&#39;sy_bar&#39;</span><span class="p">,</span><span class="s1">&#39;sz_bar&#39;</span><span class="p">),</span>
                                                        <span class="n">conv_name</span> <span class="o">=</span> <span class="s1">&#39;conv_us&#39;</span><span class="p">,</span>
                                                        <span class="n">debug</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">ans</span><span class="p">,</span><span class="s1">&#39;If the assert statement failed, _ contains some debugging info. &#39;</span>
</pre></div>
</div>
</div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">ans</span> <span class="pre">=</span> <span class="pre">False</span></code>, ask yourself the following questions:</p>
<ol class="arabic simple">
<li><p>Does your Eulerian <span class="math notranslate nohighlight">\(-\nabla \cdot (US)\)</span> close the budget?</p></li>
<li><p>Did you use the same volume transport (including bolus velocity) to calculate Eulerian budget and simulate particles?</p></li>
<li><p>Is <code class="docutils literal notranslate"><span class="pre">tub['Vol']</span></code> in this notebook the same as the one used in the Eulerian budget?</p></li>
<li><p>(If you are running time-dependent simulations) Does the time step of the particle trajectory match that of the budget?
‚Ä¶.</p></li>
</ol>
<p>If you answer is yes to all of those questions, and <code class="docutils literal notranslate"><span class="pre">ans</span></code> is still <code class="docutils literal notranslate"><span class="pre">False</span></code>. Raise an issue on <a class="reference external" href="https://github.com/MaceKuailv/seaduck/issues">GitHub</a>.</p>
<p><strong>OK, now I am going to assume you pass the check:</strong></p>
<p>I am so glad to hear that the checks passed! I am very proud of you! Now you can rest assured that we are performing the Lagrangian budget correctly.</p>
<p>All of our effort has brought us to this point. We have the trajectory and the budget. Just pass in the variable names of the RHS terms, the Eulerian tendency term, and the wall salinity, and the budget is calculated!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">walls_names</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">xname</span><span class="o">=</span><span class="s2">&quot;sx_bar&quot;</span><span class="p">,</span> <span class="n">yname</span><span class="o">=</span><span class="s2">&quot;sy_bar&quot;</span><span class="p">,</span> <span class="n">zname</span><span class="o">=</span><span class="s2">&quot;sz_bar&quot;</span><span class="p">)</span>
<span class="n">contr_dic</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">last</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">lagrangian_budget</span><span class="o">.</span><span class="n">calculate_budget</span><span class="p">(</span><span class="n">traj</span><span class="p">,</span> <span class="n">ds</span><span class="p">,</span>
                                                                  <span class="n">rhs_list</span><span class="p">,</span>
                                                                  <span class="n">prefetch_vector_kwarg</span> <span class="o">=</span> <span class="n">walls_names</span><span class="p">,</span>
                                                                  <span class="n">lhs_name</span> <span class="o">=</span> <span class="s1">&#39;tend_s&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">contr_dic</span></code> is the main result, a dictionary containing the contribution of each RHS terms.</p>
<p><code class="docutils literal notranslate"><span class="pre">s</span></code> is the salinity recorded at each boundary crossing.</p>
<p><code class="docutils literal notranslate"><span class="pre">first</span></code> and <code class="docutils literal notranslate"><span class="pre">last</span></code> are indices of where the record of a single particle begins and ends, as illustrated here</p>
<p><img alt="Schematics of the 1D layout" src="traj_layout_schematics.png" /></p>
<p><code class="docutils literal notranslate"><span class="pre">s</span></code>, all variables in <code class="docutils literal notranslate"><span class="pre">traj</span></code> and <code class="docutils literal notranslate"><span class="pre">contr_dic</span></code> are all one dimensional arrays. To retrieve the information of the <code class="docutils literal notranslate"><span class="pre">i</span></code>th (or i+1 if you count from 1) particle, one simply do <code class="docutils literal notranslate"><span class="pre">contr_dic[var][first[i]:last[i]+1]</span></code></p>
</section>
<section id="visualizing-the-results">
<h2>4. Visualizing the results<a class="headerlink" href="#visualizing-the-results" title="Permalink to this heading">#</a></h2>
<p>There are several ways to visualize the budget results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">maps</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">rhs_list</span><span class="o">+</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]:</span>
    <span class="n">maps</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">50</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">90</span><span class="p">))</span>


<span class="k">def</span><span class="w"> </span><span class="nf">cumu_map_array</span><span class="p">(</span><span class="n">traj</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">i</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="n">traj</span><span class="o">.</span><span class="n">iz</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">traj</span><span class="o">.</span><span class="n">face</span><span class="p">,</span> <span class="n">traj</span><span class="o">.</span><span class="n">iy</span><span class="p">,</span> <span class="n">traj</span><span class="o">.</span><span class="n">ix</span><span class="p">])</span>
    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">50</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">90</span><span class="p">))</span>
    <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">ind</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">array</span>


<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">rhs_list</span><span class="p">:</span>
    <span class="n">maps</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">+=</span> <span class="n">cumu_map_array</span><span class="p">(</span><span class="n">traj</span><span class="p">,</span> <span class="n">contr_dic</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>
    <span class="n">maps</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">cumu_map_array</span><span class="p">(</span><span class="n">traj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">contr_dic</span><span class="p">[</span><span class="s1">&#39;forc_s&#39;</span><span class="p">]))</span>

<span class="n">maps_ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">()</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">rhs_list</span><span class="o">+</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]:</span>
    <span class="n">maps_ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">maps</span><span class="p">[</span><span class="n">var</span><span class="p">],</span><span class="n">dims</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="s1">&#39;face&#39;</span><span class="p">,</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="s1">&#39;X&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ip</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">LambertConformal</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=-</span><span class="mf">50.0</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mf">55.0</span><span class="p">))</span>
<span class="k">for</span> <span class="n">fc</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">10</span><span class="p">]:</span>
    <span class="n">data_face</span> <span class="o">=</span> <span class="o">-</span><span class="n">maps_ds</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">][:,</span> <span class="n">fc</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;Z&quot;</span><span class="p">)</span>

    <span class="n">m1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span>
        <span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="p">[</span><span class="n">fc</span><span class="p">],</span> <span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="p">[</span><span class="n">fc</span><span class="p">],</span>
        <span class="n">data_face</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues_r&#39;</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
        <span class="n">zorder</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="p">)</span>
<span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">p</span><span class="o">.</span><span class="n">N</span><span class="p">,</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">traj</span><span class="o">.</span><span class="n">xx</span><span class="p">[</span><span class="n">first</span><span class="p">[</span><span class="n">ip</span><span class="p">]:</span><span class="n">last</span><span class="p">[</span><span class="n">ip</span><span class="p">]],</span><span class="n">traj</span><span class="o">.</span><span class="n">yy</span><span class="p">[</span><span class="n">first</span><span class="p">[</span><span class="n">ip</span><span class="p">]:</span><span class="n">last</span><span class="p">[</span><span class="n">ip</span><span class="p">]],</span>
             <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;gold&#39;</span><span class="p">,</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span>
             <span class="n">zorder</span>  <span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">transform</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">80</span><span class="p">],</span><span class="n">crs</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>The yellow lines shows a subset of the particle trajectories. The shadings are the count of grid cell crossings.</p>
<p>You can use the indices stored in <code class="docutils literal notranslate"><span class="pre">traj</span></code> to generate a ‚Äúmap of contribution‚Äù.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cmap</span> <span class="o">=</span> <span class="s2">&quot;PuOr_r&quot;</span>
<span class="n">vmax</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span>
    <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">],</span>
    <span class="n">hspace</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span>
    <span class="n">wspace</span><span class="o">=</span><span class="mf">0.05</span>
<span class="p">)</span>

<span class="n">axes</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span>
            <span class="n">gs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span>
            <span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">LambertConformal</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=-</span><span class="mf">50.0</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mf">55.0</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">axes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
<span class="n">mappable</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">rhs_list</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">fc</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">10</span><span class="p">]:</span>
        <span class="n">data_face</span> <span class="o">=</span> <span class="o">-</span><span class="n">maps_ds</span><span class="p">[</span><span class="n">var</span><span class="p">][:,</span> <span class="n">fc</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;Z&quot;</span><span class="p">)</span><span class="o">*</span><span class="n">vol_each</span><span class="o">*</span><span class="mf">1e6</span><span class="o">/</span><span class="n">ds</span><span class="o">.</span><span class="n">rA</span><span class="p">[</span><span class="n">fc</span><span class="p">]</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span>
            <span class="n">ds</span><span class="o">.</span><span class="n">XC</span><span class="p">[</span><span class="n">fc</span><span class="p">],</span> <span class="n">ds</span><span class="o">.</span><span class="n">YC</span><span class="p">[</span><span class="n">fc</span><span class="p">],</span>
            <span class="n">data_face</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
            <span class="n">vmax</span> <span class="o">=</span> <span class="n">vmax</span><span class="p">,</span>
            <span class="n">vmin</span> <span class="o">=</span> <span class="o">-</span><span class="n">vmax</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>
        <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">longname</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">80</span><span class="p">],</span><span class="n">crs</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">mappable</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mappable</span> <span class="o">=</span> <span class="n">m1</span>

<span class="n">cax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:])</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span>
    <span class="n">mappable</span><span class="p">,</span>
    <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span>
    <span class="n">extend</span> <span class="o">=</span> <span class="s1">&#39;both&#39;</span><span class="p">,</span>
    <span class="n">aspect</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
    <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span>
<span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$PSU\cdot km$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>The map of each terms to the overall salinity change. The unit is <span class="math notranslate nohighlight">\(PSU\cdot km\)</span> because we integrate in the vertical. Blue means the water is freshened.</p>
</section>
<section id="budget-closure-revisited">
<h2>5. Budget closure revisited.<a class="headerlink" href="#budget-closure-revisited" title="Permalink to this heading">#</a></h2>
<p>You can also average over all the particles to see what the contribution of each terms are.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">rhs_list</span><span class="p">:</span>
    <span class="n">change</span> <span class="o">=</span> <span class="o">-</span><span class="nb">sum</span><span class="p">(</span><span class="n">contr_dic</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Salinity Change due to </span><span class="si">{</span><span class="n">longname</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">change</span><span class="si">}</span><span class="s1"> PSU&#39;</span><span class="p">)</span>
    <span class="n">total</span><span class="o">+=</span><span class="n">change</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Sum of all terms: </span><span class="si">{</span><span class="n">total</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The change of salinity can also be calculated by taking the difference between the beginning and the end</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The total change of salinity:&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">first</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="n">s</span><span class="p">[</span><span class="n">last</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()))</span>
</pre></div>
</div>
</div>
</div>
<p>There is about a 1% mismatch, and that is because of the linear freshening trend!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">var</span> <span class="o">=</span> <span class="s1">&#39;tend_s&#39;</span>
<span class="n">change</span> <span class="o">=</span> <span class="o">-</span><span class="nb">sum</span><span class="p">(</span><span class="n">contr_dic</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">/</span><span class="n">p</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Salinity Change due to </span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">change</span><span class="si">}</span><span class="s1"> PSU&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./budget_tutorial"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="mean_eul_budg.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Calculating the mean Eulerian salinity budget in ECCOv4r4</p>
      </div>
    </a>
    <a class="right-next"
       href="../guide_for_developer.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">A guide for new contributors</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">0. Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#find-labrador-sea-water">1. Find Labrador Sea Water</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simulate-particle-trajectories">2. Simulate particle trajectories</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#budget-on-trajectories">3. Budget on trajectories</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-results">4. Visualizing the results</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#budget-closure-revisited">5. Budget closure revisited.</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Wenrui Jiang
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      ¬© Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>